# Scanning your Linode for Malware with ClamAV

## Introduction
Here are some basic instructions for running a malware scan on your system using clamav. This will assist you in investigating a system that you expect might be compromised or infected. 

{: .caution}
>
> Please note that this guide does not guarantee removal of all possible compromises, only malware known by ClamAV.
 
## Before You Begin

{: .note}
> The steps in this guide require root privileges. Since you are booting into FINNIX and using root by default, this should not be a problem. If you are adapting these steps to run in a different environment, be sure to run the steps below as `root` or with the `sudo` prefix. For more information on privileges, see our [Users and Groups](/docs/tools-reference/linux-users-and-groups) guide.

First you will want to boot your Linode into rescue mode and become familiar with its purpose.

  - https://www.linode.com/docs/troubleshooting/rescue-and-rebuild#booting-into-rescue-mode

You only need to follow the steps mentioned in "Booting into Rescue Mode" and "Connecting to a Linode Running in Rescue Mode".

The difference between rescue mode and booting your Linode normally is that in _rescue mode_, your Linode starts up from a separate Linux Distribution called FINNIX which does not automatically run any of your potentially compromised services and uses a virtual disk which is kept in memory. Changes to this virtual disk are lost if you reboot your Linode.

When you are in rescue mode, you can access your Linode’s disks, but you have to mount them first and the path to them will different than what you would see if you booted normally.

{:.note}
>
> If your Linode has had networking restrictions imposed on to prevent it from performing malicious activity such as sending out SPAM or brute forcing other servers, you will need to contact Linode Support via a [support ticket], calling 855-454-6633 in the U.S. or +1 609-380-7100 if you are calling internationally. We will temporarily lift these restrictions while you are in rescue mode.

## Installing ClamAV into the RAM Disk
The following commands will update your packages, install clamav into your temporary RAM disk, update the malware definitions and then scan your system.

### Update the packages
	apt-get update
	apt-get upgrade

 {:.note } 
>
> Press enter when you get the prompt for updating grub

### Install ClamAV
	apt-get install clamav

### Update the Malware Definitions	
	freshclam

### Mount your Linode’s Disks

{:.note}
>
> The following assumes that you have only one disk that you want to scan and you assigned that disk to `/dev/sda` when you booted into rescue mode. If you have more than one disk, just repeat the following steps for each disk that you need to mount, replacing `/dev/sda` with the name of each disk.

	mount -o barrier=0 /dev/sda

### Create a Quarantine Directory

We want to create a directory to put any malware we find so we can analyze it later if desired. 

	mkdir -p /media/sda/clamav/log/
	mkdir -p /media/sda/clamav/quarantine/

### Run the scan
	clamscan -r --log=/media/sda/clamav/log/scan.log --move=/media/sda/quarantine /media/sda

You can go through the `/media/sda/clamav/log/scan.log` after it finishes and see any found malware in `/media/sda/quarantine/`.
